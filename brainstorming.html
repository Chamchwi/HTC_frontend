<!DOCTYPE html>
<html>
<head>
	<title>HTC-"방제목"</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

	<!-- CSS  -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
	<link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/bargraph.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>

<body>
	<!-- 메인 페이지 -->
	<nav id="home" class="white" role="navigation">
  	<div class="nav-wrapper container">
    		<a id="logo-container" href="#" class="brand-logo waves-effect">토론 주제</a>
    		<ul class="right hide-on-med-and-down">
      		<li><a class="navButton modal-trigger" href="#exitModal">EXIT</a></li>
    		</ul>
    		<ul id="nav-mobile" class="side-nav">
      		<li><a class="navButton modal-trigger" href="#exitModal">EXIT</a></li>
    		</ul>
    		<a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
  	</div>
	</nav>

	<div class="container"  style="width: 100%">
  	<div class="section">
      <div class="row">
        <div class="col s12">
          <ul class="tabs">
            <li class="tab col s3 "><a class="active" href="#tab1">1단계 : 브레인스토밍</a></li>
            <li class="tab col s3 "><a href="#tab2">2단계 : 투표 개설&amp;대기</a></li>
            <li class="tab col s3 "><a href="#tab3">3단계 : 투표 진행</a></li>
            <li class="tab col s3 "><a href="#tab4">4단계 : 회의 결과</a></li>
          </ul>
        </div>
        <div class="col s3"> <!-- 채팅방 => 항상 표시되는 공간 -->
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h5 class="center">Chatting room</h5>
          <div id="chattingList" type="text" value="??? joined." disabled
          style="width:100%; height:400px; border:1px solid; border-color: black; overflow:auto;">
            <p align="left">??? joined.</p>
            <p align="right" style="color: red;">나 : 빼애애애애애애애액!!</p>
          </div>
          <div class="row">
            <div class="input-field col s12">
                <input id="first_name" type="text" class="validate" length="30" maxLength="30" onkeydown="enterMessage(event, this)">
                <label for="first_name">Enter the message.</label>
            </div>
          </div>
        </div>
        <div id="tab1" class="col s9"> <!-- 브레인스토밍 탭 -->
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h5 class="center">Idea Sketch Board</h5>
          <canvas id="ideaBoard" style="width:100%; height:400px; border:1px solid; border-color: black; ">
          </canvas>
          <div class="row">
            <div class="input-field col s3"> 
              <input id="first_name" type="text" class="validate" length="10" maxLength="10" onkeydown="enterOpinion(event, this)">
              <label for="first_name">Enter the your opinion.</label>
            </div>
            <div class="input-field col s3 center">
              <a class="waves-effect waves-light btn-large" onclick="removeOpinion()"><i class="material-icons left">no_sim</i>의견 삭제</a>
            </div>
            <div class="input-field col s3 center">
              <a class="waves-effect waves-light btn-large modal-trigger" href="#mergeModal"><i class="material-icons left">language</i>의견 그룹화</a>
            </div>
            <div class="input-field col s3 center">
              <a class="waves-effect waves-light btn-large modal-trigger" href="#nextModal1"><i class="material-icons left">play_arrow</i>다음 단계로</a>
            </div>
          </div>
        </div>
        <div id="tab2" class="col s9 center"> <!-- 투표 개설&대기 탭 -->
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h5>Vote create&amp;waiting Board</h5>
          <div id="" style="width:100%; height:400px; border:1px solid; border-color: black; overflow:auto;">
            <div class="preloader-wrapper big active">
              <div class="spinner-layer spinner-blue">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>

              <div class="spinner-layer spinner-red">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>

              <div class="spinner-layer spinner-yellow">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>

              <div class="spinner-layer spinner-green">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>
            </div>
            <br>
            <br>
            <br>
            <h5>방장이 투표를 개설중입니다. 잠시만 기다려주십시오...</h5>
          </div>
          <div class="row">
            <div class="input-field col s3 right">
              <a class="waves-effect waves-light btn-large" href="#nextModal2"><i class="material-icons left">assessment</i>투표 개설</a>
            </div>
          </div>
        </div>
        <div id="tab3" class="col s9 center"> <!-- 투표 진행 탭 -->
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h5>Let's vote!</h5>
          <div id="" style="width:100%; height:400px; border:1px solid; border-color: black; overflow:auto">
            <h4>투표</h4>
            <h6 id="topic">주제</h6>
            <div style="padding-right: 100px; padding-left: 100px">
              <ul id="voteList" class="collection">
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s3 right">
              <a class="waves-effect waves-light btn-large" href="#nextModal3"><i class="material-icons left">pause</i>투표 종료</a>
            </div>
            <div class="input-field col s3 right">
              <a class="waves-effect waves-light btn-large" onclick="submitVote()"><i class="material-icons left">thumb_up</i>투표 하기</a>
            </div>
          </div>
        </div>
        <div id="tab4" class="col s9 center"> <!-- 투표 결과 탭 -->
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h5>Result</h5>
          <div id="" style="width:100%; height:400px; border:1px solid; border-color: black; overflow:auto">
            <h4>결과</h4>
            <ul id="resultGraph" class="bargraph" style="padding-left: 100px; padding-right: 100px">
            </ul>
          </div>
          <div class="row">
          </div>
        </div>
      </div>
      <hr>
  	</div>
	</div>

  <!-- 그룹화된 의견들이 모이는 표 -->
  <div style="padding-right: 100px; padding-left: 100px">
    <ul id="mergedOpinions" class="collection">
    </ul>
  </div>

  <!-- 입장 하기 modal -->
  <div id="exitModal" class="modal modal-footer">
    <div class="modal-content">
      <h5>나가기</h5>
      <div class="row">
    <form id="exitForm" class="col s12">
      <div class="row">
        <div class="input-field col s12">
          <p>브레인스토밍 진행중입니다. 정말로 나가시겠습니까?</p>
        </div>
      </div>
    </form>
  </div>
    </div>
    <div class="modal-footer">
      <a href="index.html" class="modal-action modal-close waves-effect waves-green btn-flat">예</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat">아니오</a>
    </div>
  </div>

  <!-- 의견 그룹화 modal -->
  <div id="mergeModal" class="modal modal-footer">
    <div class="modal-content">
      <h5>의견 그룹화</h5>
      <div class="row">
        <form id="exitForm" class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <div class="row">
                <div class="input-field col s6">
                  <input id="mergeTitle" name="mergeTitle" type="text" class="validate">
                  <label for="mergeTitle">그룹명</label>
                </div>
                <div class="input-field col s6">
                  <input id="mergeComment" name="mergeComment" type="text" class="validate" placeholder="의견그룹에 의미를 부여합니다.">
                  <label for="mergeComemnt">코멘트</label>
                </div>
              </div>
              <p>설명 : 선택한 의견들을 그룹화하여 아래 표에 추가합니다. 성격이 비슷하거나 연관성있는 단어끼리 그룹화하세요. 그룹화된 의견들은 투표의 항목이 됩니다. 
              그룹화된 의견은 수정하거나 삭제할 수 없습니다.</p>
            </div>
          </div>
        </form> 
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat"
      onclick="setMerge(document.getElementById('mergeTitle').value, document.getElementById('mergeComment').value)">예</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat">아니오</a>
    </div>
  </div>

  <!-- 브레인스토밍 -> 투표 개설&대기 탭으로 넘어가는 modal -->
  <div id="nextModal1" class="modal modal-footer">
    <div class="modal-content">
      <h5>다음 단계로</h5>
      <div class="row">
        <form id="" class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <p>설명 : 브레인스토밍을 마치고 다음 단계로 진행합니다. 이 권한은 방장에게만 주어집니다. 반드시 필요한 의견들이 모두 그룹화 되었을 때 실행하세요.</p>
            </div>
          </div>
        </form> 
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat" onclick="next(1)">예</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat">아니오</a>
    </div>
  </div>

  <!-- 투표 진행 -> 투표 결과 탭으로 넘어가는 modal -->
  <div id="nextModal2" class="modal modal-footer">
    <div class="modal-content">
      <h5>다음 단계로</h5>
      <div class="row">
        <form id="" class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <div class="input-field col s12">
                <input placeholder="브레인스토밍을 통해 얻고자 한 것을 적어주세요." id="voteTitle" type="text" class="validate" length="30" maxlength="30">
                <label for="voteTitle">투표 제목</label>
              </div>
              <div class="input-field col s12">
                <input type="checkbox" id="multiple" />
                <label for="multiple">중복투표 허용</label>
              </div>
              <div class="input-field col s12">
                <p>설명 : 위의 투표 옵션을 설정하고 투표를 개설하여 시작합니다. 그룹화된 의견들이 투표의 항목으로 자동 생성됩니다. 이 권한은 방장에게만 주어집니다.</p>
              </div>
            </div>
          </div>
        </form> 
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat"
      onclick="next(2); setVote(document.getElementById('voteTitle').value, document.getElementById('multiple').checked);">예</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat">아니오</a>
    </div>
  </div>

  <!-- 투표 진행 -> 투표 결과 탭으로 넘어가는 modal -->
  <div id="nextModal3" class="modal modal-footer">
    <div class="modal-content">
      <h5>다음 단계로</h5>
      <div class="row">
        <form id="" class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <p>설명 : 투표를 종료하고 모든 유저에게 결과 화면을 출력합니다. 이 권한은 방장에게만 주어집니다. 반드시 투표 갯수가 충분히 모였을 때 실행하세요.</p>
            </div>
          </div>
        </form> 
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat" onclick="next(3); finishVote();">예</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat">아니오</a>
    </div>
  </div>

	<!-- Scripts -->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.3/fabric.min.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="js/materialize.js"></script>
	<script src="js/init.js"></script>
	<script src="js/ClientWebSocket.js"></script>
  <script src="js/Chatting.js"></script>
	<script src="js/IdeaBoard.js"></script>
	<script type="text/javascript">

    modifyOpinion(); //canvas 내의 의견을 움직일 때 반응하는 리스너 함수
    // document.getElementById('multiple').value = "off";

		function enterOpinion (event, input) {
			var isEntered = (event.keyCode == 13 && input.value != "")?  true : false;

			if (isEntered) {
        var data = setOpinion(input.value); //입력한 데이터를 바탕으로 의견텍스트를 생성 -> 중복인 경우 null

        if (data != null) { //이미 중복된 의견이면 의견을 전송하지 않음
          var json = {
            patternCode:"2",
            id:"",
            data:data
          };

          // json = JSON.stringify(json);
          // send(json); //서버로 의견 전송 작업
          add (json.data); //아이디어를 그리는 임시 코드
        }
				input.value = "";
			}
		}

		function enterMessage (event, input) {
			var isEntered = (event.keyCode == 13 && input.value != "")?  true : false;

			if (isEntered) {
        var json = {
          patternCode:"1",
          id:"",
          data : {
            name:"",
            message:input.value
          }
        };

        // json = JSON.stringify(json);
        //send(json); //서버로 메시지 전송 작업
        addChatMessage(json.data); //채팅 받는 임시 코드
				input.value = "";
			}
		}
    
    var $jq = jQuery.noConflict(); //충돌 방지

    $jq(document).ready(function() {
      $jq('.modal').modal();
    });

    $jq(document).ready(function() {
      $jq('ul.tabs').tabs();
    });

    //새로고침 방지, del키로 의견 삭제
    document.onkeydown = function(e) {
      key = (e) ? e.keyCode : event.keyCode;
      if(key==116 || (key == 37 && event.altKey == true)) {
        if(e) {
          e.preventDefault();
        } else {
          event.keyCode = 0;
          event.returnValue = false;
        }
      }
      else if (key == 46) {
        removeOpinion();
      }
    }

	</script>
</body>
</html>